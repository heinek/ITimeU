@model ITimeU.Models.CheckpointOrderModel

@{
    ViewBag.Title = "CheckpointOrder";
}

<script src="@Url.Content("~/Scripts/jquery-1.4.4.js")" type="text/javascript"></script>
<script src="@Url.Content("/Scripts/jquery.validate.min.js")" type="text/javascript"></script> 
<script src="@Url.Content("/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/Tools.js")" type="text/javascript"></script>
<script src="@Url.Content("/Scripts/CheckpointOrderHandler.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var listCheckpointOrders = $("#lstCheckpointOrders");
        var ddCheckpoints = $("#ddCheckpoint");
        var tbEdit = $("#txtStartingNumber");
        var btnChange = $("#btnChange");
        var btnDelete = $("#btnDelete");
        var lblStatus = $("#lblStatus");

        var handler = new CheckpointOrderHandler();

        handler.setEditAction(
            listCheckpointOrders,
            btnChange,
            tbEdit
        );

        handler.setDeleteAction(
            listCheckpointOrders,
            btnDelete
        );

        handler.setChangeAction(
            listCheckpointOrders,
            tbEdit
        );

    });
</script>

<script language="javascript" type="text/javascript">
    var checkpointOrders = [];
</script>

<h2>Startnummer</h2>

@*@using (Html.BeginForm()) { 
    @Html.ValidationSummary(true) *@
    <fieldset> 
        <div class="editor-label"> 
            @Html.Label("lblCheckpoint", "Checkpoint") 
        </div> 
        <div class="editor-field"> 
            @Html.ListBox("ddCheckpoint", new SelectList(ViewBag.Checkpoints, "CheckpointID", "Name"))  
            <script type="text/javascript">
                $(document).change(function () {
                    var url = "/CheckpointOrder/GetStartingNumbersForCheckpoint/?checkpointID=" + $('#ddCheckpoint').val();
                    $.get(url, function (data) {
                        $('#lstCheckpointOrders').html(data);
                    });
                });
            </script>                     
        </div> 

        <div class="editor-label"> 
            @Html.Label("lblStartingNumber", "Startnummer")             
        </div> 
        <div class="editor-field">
            @Html.TextBox("txtStartingNumber", null, new { @class = "textbox" })
            <script type="text/javascript">
                $(document).ready(function () {
                    var StartNumber = $('#txtStartingNumber');
                    var checkNumber = true;

                    StartNumber.keypress(function (e) {
                        if (String.fromCharCode(e.keyCode).match(/[^0-9\r]/g))
                        { checkNumber = false; }
                        if (e.keyCode == 13) {
                            //alert("Enter Pressed");
                            if (checkNumber == true && StartNumber.val() != '') {

                                    $('#lstCheckpointOrders').html(data);
                            //                            var tmpOrder = checkpointOrders;
                            //                            checkpointOrders = '<option value="' + $('#txtStartingNumber').val() + '">' + $('#txtStartingNumber').val() + '</option>' + tmpOrder;
                            //                            $('#lstCheckpointOrders').html(checkpointOrders);
                            //                            $('#txtStartingNumber').val("");
                            $('#ErrorMessage').hide();
                            StartNumber.select();
                        }
                        else {
                            $('#ErrorMessage').show();
                            StartNumber.val('');
                            checkNumber = true;
                        }
                        }
                    });
                }); 
            </script>            
            <input type="button" id="btnChange" value="Endre" style="width: 100px" disabled="disabled" />
            <input type="button" id="btnDelete" value="Slett" style="width: 100px" disabled="disabled" />

             <div class="editor-label"> 
            @Html.Label("lblOrderNumber", "Ordernummer")             
        </div> 
        <div class="editor-field">
            @Html.TextBox("txtOrderNumber", null, new { @class = "textbox" })
            <script type="text/javascript">
                $(document).ready(function () {
                    var OrderNumber = $('#txtOrderNumber');
                    var checkNumber = true;

                    OrderNumber.keypress(function (e) {
                        if (String.fromCharCode(e.keyCode).match(/[^0-9\r]/g))
                            checkNumber = false;
                        if (e.keyCode == 13) {
                            if (checkNumber == true && OrderNumber.val() != '') {
                                var url = "/CheckpointOrder/AddCheckpointByOrder/?checkpointID=" + $('#ddCheckpoint').val() + "&startingNumber=" + $('#txtStartingNumber').val() + "&orderNumber=" + $('#txtOrderNumber').val();
                                $.get(url, function (data) {
                                    $('#lstCheckpointOrders').html(data);
                                    $('#ErrorMessage').hide();
                                    //StartNumber.select();
                                });
                            }
                            else {
                                $('#ErrorMessage').show();
                                //StartNumber.val('');
                                checkNumber = true;
                            }
                        }
                    });
                }); 
            </script> 
        </div> 

         <div id="ErrorMessage" style="color:Red; display:none" > 
           ** Start Number Should be a Number (0-9)
       </div> 

       <div class="editor-label"> 
            @Html.Label("lblCheckpointOrders", "CheckpointOrders") 
       </div>

        <div class="editor-field">
            @Html.ListBox("lstCheckpointOrders", new SelectList(Model.CheckpointOrderDic, "Key", "Value"),new { @class = "listbox" })    
        </div>

    </fieldset>
@*}*@