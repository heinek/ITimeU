@model ITimeU.Models.CheckpointOrderModel

@{
    ViewBag.Title = "CheckpointOrder";
}

<script src="@Url.Content("~/Scripts/jquery-1.4.4.js")" type="text/javascript"></script>
<script src="@Url.Content("/Scripts/jquery.validate.min.js")" type="text/javascript"></script> 
<script src="@Url.Content("/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/Tools.js")" type="text/javascript"></script>
<script src="@Url.Content("/Scripts/CheckpointOrderHandler.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var listCheckpointOrders = $("#lstCheckpointOrders");
        var ddCheckpoints = $("#ddCheckpoint");
        var tbEdit = $("#txtStartingNumber");
        var btnChange = $("#btnChange");
        var btnDelete = $("#btnDelete");
        var lblStatus = $("#lblStatus");
        var btnUp = $("#btnUp");
        var btnDown = $("#btnDown");

        var handler = new CheckpointOrderHandler();

        handler.setEditAction(
            listCheckpointOrders,
            btnChange,
            tbEdit
        );

        handler.setDeleteAction(
            listCheckpointOrders,
            btnDelete
        );

        handler.setChangeAction(
            listCheckpointOrders,
            tbEdit,
            btnUp,
            btnDown
        );

        handler.setMoveUpAction(
            listCheckpointOrders,
            btnUp
        );

        handler.setMoveDownAction(
            listCheckpointOrders,
            btnDown
        );

        handler.setddCheckpointChangeAction(
        ddCheckpoints
        );

        

    });
</script>

<script language="javascript" type="text/javascript">
    var checkpointOrders = [];
</script>

<h2>Startnummer</h2>

@*@using (Html.BeginForm()) { 
    @Html.ValidationSummary(true) *@
    <fieldset> 
        <div class="editor-label"> 
            @Html.Label("lblCheckpoint", "Checkpoint") 
        </div> 
        <div class="editor-field"> 
            @Html.ListBox("ddCheckpoint", new SelectList(ViewBag.Checkpoints, "CheckpointID", "Name"))                        
        </div> 

        <div class="editor-label"> 
            @Html.Label("lblStartingNumber", "Startnummer")             
        </div> 
        <div class="editor-field">
            @Html.TextBox("txtStartingNumber", null, new { @class = "textbox" })
            <script type="text/javascript">
                $(document).ready(function () {
                    var StartNumber = $('#txtStartingNumber');
                    var checkNumber = true;

                    var startNumberList = $('#lstCheckpointOrders');

                    StartNumber.keypress(function (e) {
                        if (String.fromCharCode(e.keyCode).match(/[^0-9\r]/g))
                        { checkNumber = false; }
                        if (e.keyCode == 13) {
                            //alert("Enter Pressed");
                            if (checkNumber == true && StartNumber.val() != '') {
                                var itemExists = false;                                
                                $("#lstCheckpointOrders option").each(function () { //Check for duplicate startNumber in List
                                    if ($(this).text() == StartNumber.val()) {
                                        itemExists = true;                                        
                                    }                                    
                                });
                                if (itemExists) {
                                    $('#ErrorMessage').show().html('** Start Number already exist');
                                    StartNumber.select()
                                }
                                else {
                                    var url = "/CheckpointOrder/AddCheckpointOrder/?checkpointID=" + $('#ddCheckpoint').val() + "&startingNumber=" + $('#txtStartingNumber').val();
                                    $.get(url, function (data) {
                                        $('#lstCheckpointOrders').html(data);
                            //                            var tmpOrder = checkpointOrders;
                            //                            checkpointOrders = '<option value="' + $('#txtStartingNumber').val() + '">' + $('#txtStartingNumber').val() + '</option>' + tmpOrder;
                            //                            $('#lstCheckpointOrders').html(checkpointOrders);
                            //                            $('#txtStartingNumber').val("");
                                        $('#ErrorMessage').hide();                                        
                                        StartNumber.select();
                                    });
                                }
                            }
                        else {
                                $('#ErrorMessage').show().html('** Start Number Should be a Number (0-9)');
                            StartNumber.val('');
                            checkNumber = true;
                        }
                        }
                    });
                }); 
            </script>            
            <input type="button" id="btnChange" value="Endre" style="width: 100px" disabled="disabled" />
            <input type="button" id="btnDelete" value="Slett" style="width: 100px" disabled="disabled" />
            </div>
 

         <div id="ErrorMessage" style="color:Red; display:none" >            
       </div>       

       <div class="editor-label" > 
            @Html.Label("lblCheckpointOrders", "CheckpointOrders") 
       </div>

        <div class="editor-field" style="position:relative">
            @Html.ListBox("lstCheckpointOrders", new SelectList(Model.CheckpointOrderDic, "Key", "Value"),new { @class = "listbox" })  
        
        
        <div style="position:absolute; top:100px; left:100px; width:100px"> 

            <input type="button" class="btnUp" id="btnUp" value="" style="width:25px; height:25px" disabled="disabled" />
            </br></br>
            <input type="button" class="btnDown" id="btnDown" value="" style="width:25px; height:25px" disabled="disabled" />
        </div>
        </div>

    </fieldset>
@*}*@